substitutions:
  device_name: open-air-mini
  friendly_name: Open AIR Mini
  sensor_interval: 10 # seconds

packages: !include common.yaml

esp32:
  board: esp32dev
  framework:
    type: esp-idf

# Enable logging
logger:
  level: DEBUG

# From V1.4.0 The Sensor pins on the Open AIR Mini are swapped. Correct example is below:
#uart:
##UART For Sensor 2
# - rx_pin: GPIO13
#   tx_pin: GPIO12
#   baud_rate: 9600
#   id: uart_sensor_2
##UART For Sensor 1
# - rx_pin: GPIO25
#   tx_pin: GPIO26
#   baud_rate: 9600
#   id: uart_sensor_1

i2c:
##I2C For Sensor 2
#- id: i2c_sensor_2
#  sda: GPIO19
#  scl: GPIO18
#  scan: false
#  frequency: 400kHz
#I2C For Sensor 1
- id: i2c_sensor_1
  sda: GPIO16
  scl: GPIO4
  scan: false
  frequency: 400kHz

# Status led
status_led:
  pin:
    number: GPIO33

#PWM output for controlling the motor.
output:
  - platform: ledc
    pin:
      number: GPIO15
      ignore_strapping_warning: true
    inverted: true
    id: open_air_mini

fan:
  - platform: speed
    output: open_air_mini
    name: "${friendly_name} Fan"
    id: fan_motor

sensor: 
  - platform: pulse_counter
    pin: GPIO14
    unit_of_measurement: 'RPM'
    name: '${friendly_name} RPM'
    id: open_air_mini_rpm
    update_interval: 10s
    total:
      unit_of_measurement: 'Rotations'
      name: '${friendly_name} Rotations'
      state_class: total_increasing
  - platform: scd4x
    i2c_id: i2c_sensor_1
    co2:
      name: "${friendly_name} Sensor 1 CO2"
      id: air_Co2
      accuracy_decimals: 0
    temperature:
      name: "${friendly_name} Sensor 1 Temperature"
      id: air_temperature
      accuracy_decimals: 2
    humidity:
      name: "${friendly_name} Sensor 1 Humidity"
      id: air_humidity
      accuracy_decimals: 2
    update_interval: "${sensor_interval}s"
    measurement_mode: periodic

  - platform: sgp4x
    i2c_id: i2c_sensor_1
    voc:
      name: "${friendly_name} VOC Index "
      id: air_VOC
    nox:
      name: "${friendly_name} NOx Index "
      id: air_NOx
    compensation:
      temperature_source: air_temperature #Make sure to match these if you change ID's.
      humidity_source: air_humidity       #Make sure to match these if you change ID's.
    update_interval: "${sensor_interval}s"
